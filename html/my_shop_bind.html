<!doctype html>
<html>

<head>
	<meta charset="UTF-8">
	<title>注册-门店绑定</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<link href="../css/mui.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="../css/mui.picker.css">
	<link rel="stylesheet" href="../css/mui.poppicker.css">
	<link rel="stylesheet" type="text/css" href="../css/certification_not_cooperation.css" />
	<link rel="stylesheet" type="text/css" href="../css/certification_shop.css" />

</head>

<body style="background-color: #EEEEEE;">
	<header class="mui-bar mui-bar-nav mui-bar-nav-bg" style="background-color: white; box-shadow: none; border-bottom: 1px solid #CCCCCC;">
		<span class="mui-icon mui-icon-back"></span>
		<font class="mui-title" style="font-size: 18px; color: #333333;">绑定店铺</font>
	</header>
	<div class="mui-content" style="background-color: #EEEEEE;">
		<div class="hezuo-zhuangtai">
			<div class="zhuangtai-title">
				<font>请选择所在店铺与GO佳居网合作状态</font>
			</div>
			<div class="zhuangtai-xuanze">
				<div class="mui-input-row mui-radio mui-left">
					<label>认证店铺</label>
					<input name="radio1" type="radio" checked="checked" onclick="checkRadio1()">
				</div>
				<div class="mui-input-row mui-radio mui-left">
					<label>暂未合作</label>
					<input name="radio1" type="radio" onclick="checkRadio2()">
				</div>
			</div>
		</div>
		<div class="item1">
			<div class="dianpu-info">
				<div class="dianpu-title">
					<font>店铺信息</font>
				</div>
				<div class="dianpu-yanzheng">
					<div class="yanzheng-content">
						<div style="float: left; width: 70px; margin-top: 20px;">
							<span style="font-size: 15px; color: #333333; ">店铺编号</span>
						</div>
						<div class="dianpu-bianhao-input">
							<input id="code" type="number" style="margin-top:10px;" name="dianpu-bianhao" placeholder="请填写您所在的店铺编号" />
						</div>
						<input id="prove" type="button" value="验证" />
					</div>
				</div>
			</div>
			<div class="dianpu-xinxi">
				<div class="product-name-content">
					<div class="product-name">商户名称：</div>
					<div class="product-name-input">
						<input type="text" id="product" placeholder="请填写您所经营品牌名称" />
					</div>
				</div>
				<div class="area-name-content">
					<div class="area-name">所在地区：</div>
					<div class="area-name-input">
						<input type="text" id="area" placeholder="请填写您所在的地区" />
					</div>
				</div>
				<div class="mall-name-content">
					<div class="mall-name">所在商场：</div>
					<div class="mall-name-input">
						<input type="text" id="mall" placeholder="请填写您所在的商场" />
					</div>
				</div>
			</div>
			<div class="store-photo-content">
				<div class="store-photo-caption">
					<div style=" position: absolute; left: 0; height: 100%; width: 120px;">与门店合影照片</div>
				</div>
				<div class="photo-claim">请上传您与所在门店合影照片(需显示门头上LOGO)</div>
				<div class="photo">
					<img id="img" src="../img/photo.png" style="width: 100%; height: 100%;" />
				</div>
				<button class="upload" id="upload">上传照片</button>
			</div>
			<!-- <a href="certification_review.html"> -->
			<button class="next-btn" id="nextBtn1">下一步</button>
			<!-- </a> -->
		</div>
		<div class="item2">
			<div class="store-info">
				<div class="store-caption">店铺信息</div>
				<div class="store-info-content">
					<div class="store-name-content">
						<div class="store-name">店铺名称</div>
						<div class="store-name-input">
							<input type="text" id="storeName" placeholder="请填写您所在的店铺名称" />
						</div>
					</div>
					<div class="store-area-content">
						<div class="store-area">所在地区</div>
						<div class="store-area-input">
							<input class="store-area-input1" id="storeArea" type="text" placeholder="请填写您所在店铺的区域" disabled="true" />
						</div>
						<div class="area-choice">
							选择
							<span class="mui-icon mui-icon-arrowright" style="font-size: 15px;float:right;margin-top:2px;"></span>
						</div>
					</div>
					<div class="store-address-content">
						<div class="store-address">详细地址</div>
						<div class="store-address-input">
							<input type="text" id="storeAddress" placeholder="如街道或所在卖场的名称" />
						</div>
					</div>
				</div>
			</div>
			<div class="principal-info">
				<div class="principal-caption-content">
					<div class="principal-caption">店铺负责人信息</div>
					<div class="optional">(选填)</div>
				</div>
				<div class="principal-content">
					<div class="principal-name-content">
						<div class="principal-name">负责人姓名</div>
						<div class="principal-name-input">
							<input type="text" id="principalName" placeholder="请输入负责人真实姓名" />
						</div>
					</div>
					<div class="principal-phone-content">
						<div class="principal-phone">负责人手机</div>
						<div class="principal-phone-input">
							<input type="text" id="principalPhone" placeholder="请输入负责人手机号码" />
						</div>
					</div>
				</div>
			</div>
			<div class="red-envelope-content">
				<div class="red-envelope">
					<img src="../img/red_envelope.png" style="width: 100%; height: 100%;" />
				</div>
				<div class="red-envelope-caption-content">
					<div class="red-envelope-description">
						店铺认证红包
						<p style="font-size: 12px; color: #999999;">推荐的店铺通过认证后你将获得红包奖励哦!</p>
					</div>
				</div>
			</div>
			<div class="next-btn-content">
				<!-- <a href="certification_review.html"> -->
				<button class="next-btn" id="nextBtn2">下一步</button>
				<!-- </a> -->
			</div>
		</div>
	</div>
</body>
<script src="../js/mui.min.js"></script>
<script type="text/javascript" src="../js/jquery-1.11.0.min.js"></script>
<script src="../js/qiniuUploader.js"></script>
<script src="../js/mui.picker.min.js"></script>
<script type="text/javascript" src="../js/icon-back.js"></script>
<script src="../js/util.js"></script>
<script src="../js/city_data.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">

	var storeName = $('#storeName').val()
	var storeArea = $('#storeArea').val()
	var storeAddress = $('#storeAddress').val()
	var principalName = $('#principalName').val()
	var principalPhone = $('#principalPhone').val()
	var dooeImage, operatorCode, operatorName, storecode
	mui.init(

	)
	function checkRadio1() {
		$('.item1').show()
		$('.item2').hide()
	}
	function checkRadio2() {
		$('.item1').hide()
		$('.item2').show()
	}
	// 选择地址
	$('.area-choice').on('tap', function () {
		var _self = this;
		$util.showAdPicker(__CITY__, function (sel) {
			console.log(sel)
			$('#storeArea').val(sel[0].text + '-' + sel[1].text + '-' + sel[2].text)
			localStorage.setItem('storeProvince', sel[0].value)
			localStorage.setItem('storeCity', sel[1].value)
			localStorage.setItem('storeArea', sel[2].value)
		});
	})

	// 验证店铺
	$('#prove').on('tap', function () {
		merchant()
	})
	// 2019022000003
	// 商户店铺表接口(merchant_store_info)
	function merchant() {
		storecode = $('#code').val()
		console.log(storecode)
		$util.http('/api/merchant-store-storeCode/?storeCode=' + storecode, {
			dataType: 'json',
			type: 'get',
			success: function (res) {
				console.log(res)
				$('.dianpu-xinxi').css('display', 'block')
				$('#product').val(res.storeName)
				$('#area').val(res.storeAddress)
				$('#mall').val(res.storeCommunity)
				localStorage.setItem('merStoreinfoId', res.id)
			}
		})
	}

	// 选择照相机还是相册
	document.getElementById('upload').addEventListener('tap', function () {
		if (mui.os.plus) {
			var buttonTit = [{
				title: "拍照"
			}, {
				title: "从手机相册选择"
			}];

			plus.nativeUI.actionSheet({
				title: "上传图片",
				cancel: "取消",
				buttons: buttonTit
			}, function (b) { /*actionSheet 按钮点击事件*/
				switch (b.index) {
					case 0:
						break;
					case 1:
						getImage(); /*拍照*/
						break;
					case 2:
						galleryImg();/*打开相册*/
						break;
					default:
						break;
				}
			})
		}
	}, false);

	// 拍照获取图片
	function getImage() {
		var c = plus.camera.getCamera();
		c.captureImage(function (e) {
			plus.io.resolveLocalFileSystemURL(e, function (entry) {
				var imgSrc = entry.toLocalURL() + "?version=" + new Date().getTime(); //拿到图片路径
				// 其他操作,比如预览展示
				$('#img').attr('src', imgSrc)
				getQiniuToken(imgSrc)
			}, function (e) {
				console.log("读取拍照文件错误：" + e.message);
			});
		}, function (s) {
			console.log("error" + s);
		}, {
				filename: "_doc/camera/"
			})
	}

	// 从相册中选择图片 
	function galleryImg() {
		// 从相册中选择图片
		plus.gallery.pick(function (e) {
			for (var i in e.files) {
				var fileSrc = e.files[i];
				// 其他操作,比如预览展示
				$('#img').attr('src', fileSrc)
				getQiniuToken(fileSrc)
			}
		}, function (e) {
			console.log("取消选择图片");
		}, {
				filter: "image",
				multiple: true,
				maximum: 1,
				system: false,
				onmaxed: function () {
					plus.nativeUI.alert('最多只能选择1张图片');
				}
			});
	}
	function getQiniuToken(src) {
		$util.uploadToQiniu(src, function (imgPath) {
			// 完整的url
			console.log(imgPath)
			localStorage.setItem('doorImage', imgPath)
		})
	}
	// 调取上传店铺的接口
	function uppic() {
		var doorImage = localStorage.getItem('doorImage'),
			operatorCode = localStorage.getItem('operatorCode'),
			operatorName = localStorage.getItem('operatorName'),
			operatorIdentityNo = localStorage.getItem('operatorIdentityNo'),
			password = localStorage.getItem('password'),
			operatorMobile = localStorage.getItem('operatorMobile'),
			id = localStorage.getItem('id'),
			merStoreinfoId = localStorage.getItem('merStoreinfoId'),
			operatorType = localStorage.getItem('operatorType'),
			applyStatus = 0
		localStorage.setItem('applyStatus', applyStatus)
		$util.http('/api/merchant-operators', {
			data: {
				id: id,                                      //id
				operatorCode: operatorCode,					//顾问编号
				operatorType: operatorType,					//顾问身份类型
				operatorName: operatorName,	                	//真实姓名
				operatorIdentityNo: operatorIdentityNo,     	//身份证号码
				registerAgreement: 'Y',						 //平台注册协议
				status: true,                                 //是否激活
				password: password,                            //登陆密码
				operatorMobile: operatorMobile,                 //手机号码
				merStoreinfoId: merStoreinfoId,                  //店铺id
				applyStatus: applyStatus,                             //申请店铺绑定的状态
				doorImage: doorImage                    //门店合影照
			},
			dataType: 'json',
			type: 'put',
			success: function (res) {
				console.log(res)
				localStorage.setItem('merchantStoreinfoId', res.id)
				localStorage.setItem('merchantStoreInfoName', res.storeName)
				mui.openWindow(
					'certification_review.html',
					'certification_review',
					{}
				)
			}
		})
	}
	// 点击暂未合作
	
	// 上传无合作店铺的信息，获取编号
	function getCode(){
		var storeName = $('#storeName').val(),
			storeProvince = localStorage.getItem('storeProvince'),
			storeCity = localStorage.getItem('storeCity'),
			storeArea = localStorage.getItem('storeArea'),
			storeAddress = $('#storeAddress').val(),
			storeMobile = $('#principalPhone').val(),
			storeBusinessMan = $('#principalName').val()
		$util.http('/api/merchant-store-infos', {
			data:{
				status:true,
				storeProvince,
				storeName,
				storeCity,
				storeArea,
				storeAddress,
				storeMobile,
				storeBusinessMan
			},
			dataType: 'json',
			type: 'post',
			success: function (res) {
				mui.openWindow(
						'certification_review.html',
						'certification_review',
						{}
			)		
																			
			}
		})
	}
	// 点击下一步
	$('#nextBtn1').on('tap', function () {
		uppic()
	})
	// 点击下一步
	$('#nextBtn2').on('tap', function () {
		getCode()
	})
</script>

</html>