<!DOCTYPE html>
<html lang="zh">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<title>个人信息</title>
	<link rel="stylesheet" href="../css/mui.css" />
	<link rel="stylesheet" href="../css/common.css" />
	<link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css" />
	<link rel="stylesheet" type="text/css" href="../css/mui.dtpicker.css" />
	<link rel="stylesheet" type="text/css" href="../css/user-infomation.css" />
	<link rel="stylesheet" type="text/css" href="../css/personal_information.css" />
	<style>
		.msg1 {
			vertical-align: middle;
		}

		.msg {
			float: right;
			color: rgb(153, 153, 153);
			margin-top: 3%;
		}

		.mui-icon-arrowright {
			float: right;
			color: rgb(153, 153, 153);
			font-size: 15px;
			margin-top: 3.5%;

		}

		.msgAll li {
			border-bottom: 1px solid rgb(230, 230, 230);
		}

		.msgAll input {
			font-size: 14px;
		}
	</style>
</head>

<body>
	<!--头部信息-->
	<div class="information-image">
		<!--标题-->
		<div class="information-title">
			<span class="mui-icon mui-icon-back"></span>
			<p class="title">个人信息</p>
		</div>
		<!--进度条-->
		<div>
			<p>信息完整度31%</p>
			<div id="progress" class="mui-progressbar mui-progressbar-green ">
				<span></span>
			</div>
		</div>
		<!--头像ID-->
		<div>
			<div class="touxiang-wrap">
				<img src="../img/touxiang.png" alt="头像" class="touxiang position" id="avatar_img" onclick="avatar_change.click()" />
				<input id="avatar_change" type="file" onchange="chooseAvatar(this)" style="display:none">
				<!-- <img src="../img/avatar.png" class="avatar-img" id="avatar_img" onclick="avatar_change.click()" /> -->
			</div>
			<div>
				<p>设置头像</p>
				<p>个人编码:GO201820123</p>
			</div>
		</div>
	</div>

	<ul style="padding:0 15px;" class="msgAll">
		<li class="msgChild">
			<span>昵称:</span>
			<input type="text" placeholder="设置个人昵称">
		</li>
		<li class="msgChild">
			<span class="msg1">真实姓名：</span>
			<input type="text">
			<a href="real_name_certification.html">
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">去认证</span>
		</a> 
		</li>
		<li class="msgChild">
			<span>身份证号：</span>
			<input type="text">
			<a href="real_name_certification.html">
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">去认证</span> 
		</a> 
		</li>
		<li class="msgChild">
			<span>性别：</span>
			<input type="text">
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">选择</span>
		</li>
		<li class="msgChild">
			<span>出生日期：</span>
			<input type="text">
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">选择</span>

		</li>
		<li class="msgChild">
			<span>手机：</span>
			<input type="text">
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">修改</span>

		</li>
		<li class="msgChild">
			<span>邮箱：</span>
			<input type="text">
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">绑定</span>

		</li>
		<li class="msgChild">
			<span>所在城市：</span>
			<input type="text">
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">选择</span>
		</li>
		<li class="msgChild">
			<span>街道地址：</span>
			<input type="text">
		</li>
		<li class="msgChild">
			<span>我的职业：</span>
			<input type="text">
		</li>
		<li class="msgChild">
			<span>从业年限：</span>
			<input type="text">
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">选择</span>
		</li>
		<li class="msgChild">
			<span>单位名称：</span>
			<input type="text">
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">暂未绑定</span>
		</li>
		<li class="msgChild">
			<span>个性签名：</span>
			<input type="text" placeholder="请填写个性签名">
		</li>
	</ul>

	<div class="submit">
		<p>保存</p>
	</div>
</body>
<script src="../js/mui.min.js"></script>
<script type="text/javascript" src="../js/jquery-1.11.0.min.js"></script>
<script src="../js/common.js"></script>
<script src="../js/mui.picker.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/mui.dtpicker.js" type="text/javascript"></script>
<script src="../js/mui.poppicker.js" type="text/javascript"></script>
<script type="text/javascript" src="../js/back-to-top.js"></script>
<script src="../js/city_data.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/util.js"></script>
<script type="text/javascript">
	mui.init(
		Mobile()   //显示手机号
	)
	// 设置头像
	var sex, operatorName
	function chooseAvatar(file) {
		var file = file.files[0];
		var reader = new FileReader();
		reader.readAsDataURL(file);
		reader.onload = function () {
			var img = document.getElementById('avatar_img');
			img.src = this.result
			var avatar = img.src
			getQiniuToken(avatar)
		};
	}

	function getQiniuToken(src) {
		$util.uploadToQiniu(src, function (imgPath) {
			// 完整的url
			console.log(imgPath)
			localStorage.setItem(avar, imgPath)
		})
	}
	// 个人信息的接口
	function postmerchant() {
		console.log(sex)
		//所缺少字段    出生日期    从业年限
		var id = localStorage.getItem('id'),
			avatar = localStorage.getItem('avatar'),
			operatorCode = localStorage.getItem('operatorCode'),
			password = localStorage.getItem('password'),
			operatorType = localStorage.getItem('operatorType'),
			avatar = localStorage.getItem('avatar'),                   //个人头像
			var personalSignature  = $('.msgChild').eq(13).val()    // 个性签名
			operatorIdentityNo = localStorage.getItem('operatorIdentityNo'),
			//性别
			operatorMobile = localStorage.getItem('operatorMobile'),   //手机
			nickName = $('.msgChild').eq(0).val(),
			operatorEmail = $('.msgChild').eq(6).val(),                   //邮箱
			streetName = $('.msgChild').eq(8).find('input').val(),
			companyName  = $('.msgChild').eq(12).find('input').val()
			localStorage.setItem('personalSignature',personalSignature)
		$util.http('/api/merchant-operators', {
			data: {
				id: id,                                      //id
				operatorCode: operatorCode,					//顾问编号
				operatorType: operatorType,					//顾问身份类型
				operatorName: operatorName,	                	//真实姓名
				operatorIdentityNo: operatorIdentityNo,     	//身份证号码
				registerAgreement: 'Y',						 //平台注册协议
				status: true,                                 //是否激活
				password: password,                            //登陆密码
				operatorMobile: operatorMobile,                 //手机号码
				avatar,                                       //头像
				sex,
				nickName,
				streetName,
				operatorEmail,
				companyName,
				personalSignature                           //个性签名
			},
			dataType: 'json',
			type: 'put',
			success: function (res) {
				console.log(res)
			}
		})
	}

	// 保存
	$('.submit').on('tap', function () {
		postmerchant()
	})
	// 真实姓名
	$('.msgChild').eq(1).find('input').on('tap', function () {
		operatorName = localStorage.getItem('operatorName')
		if(operatorName == 'null'){
			$(this).val('请实名认证')
		}else{
			$(this).val(operatorName)
		}
		
	})
	// 身份证号
	$('.msgChild').eq(2).find('input').on('tap', function () {
		operatorIdentityNo = localStorage.getItem('operatorIdentityNo')
		if(operatorIdentityNo == 'null'){
			$(this).val('请实名认证')
		}else{
			$(this).val(operatorIdentityNo)
		}
		
	})

	// 选择性别
	$('.msgChild').eq(3).on('tap', function () {
		var picker = new mui.PopPicker();
		picker.setData([{
			value: '0',
			text: '女士'
		},
		{
			value: '1',
			text: '男士'
		}]);
		picker.show(function (selectItems) {
			console.log(selectItems)
			$('.msgChild').eq(3).find('input').val(selectItems[0].text)
			sex = selectItems[0].value
			localStorage.setItem('sex', sex)
		})
	})
	//选择日期
	$('.msgChild').eq(4).on('tap', function () {
		console.log(1)
		$util.showDatePicker(function (date) {
			console.log(date)
			$('.msgChild').eq(4).find('input').val(date.value)
		})
	});
//手机
	function Mobile(){
		operatorMobile = localStorage.getItem('operatorMobile')
		$('.msgChild').eq(5).find('input').val(operatorMobile)
	}
// 所在城市
$('.msgChild').eq(7).on('tap', function () {
		$util.showAdPicker(__CITY__,function(datas){
			console.log(datas[0].text + '-'+datas[1].text+'-'+datas[2].text)
			$('.msgChild').eq(7).find('input').val(datas[0].text + '-'+datas[1].text+'-'+datas[2].text)
		});
	});
// 街道地址
// 我的职业
function myType(){
	console.log(1)
	var operatorType = localStorage.getItem('operatorType')
	if(operatorType == 1){
		$('.msgChild').eq(9).find('input').val('家居顾问')
	}else if(operatorType == 2){
		$('.msgChild').eq(9).find('input').val('设计顾问')
	}
}
// 从业年限
function myType(){
	var operatorType = localStorage.getItem('operatorType')
	var picker = new mui.PopPicker();
	
}
</script>

</html>