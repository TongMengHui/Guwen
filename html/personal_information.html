<!DOCTYPE html>
<html lang="zh">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<title>个人信息</title>
	<link rel="stylesheet" href="../css/mui.css" />
	<link rel="stylesheet" href="../css/common.css" />
	<link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css" />
	<link rel="stylesheet" type="text/css" href="../css/mui.dtpicker.css" />
	<link rel="stylesheet" type="text/css" href="../css/user-infomation.css" />
	<link rel="stylesheet" type="text/css" href="../css/personal_information.css" />
	<style>
		.msg1 {
			vertical-align: middle;
		}

		.msg {
			float: right;
			color: rgb(153, 153, 153);
			margin-top: 3%;
		}

		.mui-icon-arrowright {
			float: right;
			color: rgb(153, 153, 153);
			font-size: 15px;
			margin-top: 3.5%;

		}

		.msgAll li {
			border-bottom: 1px solid rgb(230, 230, 230);
		}

		.msgAll input {
			font-size: 14px;
		}
	</style>
</head>

<body>
	<!--头部信息-->
	<div class="information-image">
		<!--标题-->
		<div class="information-title">
			<span class="mui-icon mui-icon-back"></span>
			<p class="title">个人信息</p>
		</div>
		<!--进度条-->
		<div>
			<p id="process">信息完整度31%</p>
			<div id="progress" class="mui-progressbar mui-progressbar-green ">
				<span></span>
			</div>
		</div>
		<!--头像ID-->
		<div>
			<div class="touxiang-wrap">
				<img src="../img/touxiang.png" alt="头像" class="touxiang position" id="avatar_img" onclick="avatar_change.click()" />
				<input id="avatar_change" type="file" onchange="chooseAvatar(this)" style="display:none">
				<!-- <img src="../img/avatar.png" class="avatar-img" id="avatar_img" onclick="avatar_change.click()" /> -->
			</div>
			<div>
				<p>设置头像</p>
				<p>个人编码:GO201820123</p>
			</div>
		</div>
	</div>

	<ul style="padding:0 15px;" class="msgAll">
		<li class="msgChild">
			<span>昵称:</span>
			<input type="text" placeholder="设置个人昵称">
		</li>
		<li class="msgChild">
			<span class="msg1">真实姓名：</span>
			<input type="text">
			<!-- <a href="real_name_certification.html"> -->
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">去认证</span>
			<!-- </a>  -->
		</li>
		<li class="msgChild">
			<span>身份证号：</span>
			<input type="text">
			<!-- <a href="real_name_certification.html"> -->
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">去认证</span>
			<!-- </a>  -->
		</li>
		<li class="msgChild">
			<span>性别：</span>
			<input type="text">
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">选择</span>
		</li>
		<li class="msgChild">
			<span>出生日期：</span>
			<input type="text">
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">选择</span>

		</li>
		<li class="msgChild">
			<span>手机：</span>
			<input type="text">
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">修改</span>

		</li>
		<li class="msgChild">
			<span>邮箱：</span>
			<input type="text">
			<!-- <span class="mui-icon mui-icon-arrowright"></span> -->
			<!-- <span class="msg">绑定</span> -->

		</li>
		<li class="msgChild">
			<span>所在城市：</span>
			<input type="text">
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">选择</span>
		</li>
		<li class="msgChild">
			<span>街道地址：</span>
			<input type="text">
		</li>
		<li class="msgChild">
			<span>我的职业：</span>
			<input type="text">
		</li>
		<li class="msgChild">
			<span>从业年限：</span>
			<input type="text">
			<span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">选择</span>
		</li>
		<li class="msgChild">
			<span>单位名称：</span>
			<input type="text">
			<!-- <span class="mui-icon mui-icon-arrowright"></span>
			<span class="msg">暂未绑定</span> -->
		</li>
		<li class="msgChild">
			<span>个性签名：</span>
			<input type="text" placeholder="请填写个性签名">
		</li>
	</ul>

	<div class="submit">
		<p id="submit">保存</p>
	</div>
</body>
<script src="../js/mui.min.js"></script>
<script type="text/javascript" src="../js/jquery-1.11.0.min.js"></script>
<script src="../js/common.js"></script>
<script src="../js/mui.picker.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/mui.dtpicker.js" type="text/javascript"></script>
<script src="../js/mui.poppicker.js" type="text/javascript"></script>
<script src="../js/qiniuUploader.js"></script>
<script type="text/javascript" src="../js/back-to-top.js"></script>
<script src="../js/city_data.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/util.js"></script>
<script type="text/javascript">
	mui.init(
		name(),  //真实姓名
		identityNo(), //身份证号
		Mobile(),   //显示手机号
		myType()    //职业
	)
	percent()
	$('input').bind("input propertychange",function(){
		percent()
	})
	// 百分比信息
	function percent() {
		var progress = 0,
			input = document.getElementsByTagName('input'),
			num = 0;
		for (var i = 0; i < input.length; i++) {
			
			if (input[i].value != '') {
				num += 1
				console.log(num)
			}
		}
		progress = parseInt(num/13 * 100) 
		console.log(progress)
		mui("#progress").progressbar({ progress }).show();
		$('#process').text('信息完整度'+progress+'%')
	}
	// 设置头像
	var sex, operatorName
	function chooseAvatar(file) {
		var file = file.files[0];
		var reader = new FileReader();
		reader.readAsDataURL(file);
		reader.onload = function () {
			var img = document.getElementById('avatar_img');
			img.src = this.result
			var avatar = img.src
			getQiniuToken(avatar)
		};
	}

	function getQiniuToken(src) {
		$util.uploadToQiniu(src, function (imgPath) {
			console.log(imgPath)
			localStorage.setItem('avatar', imgPath)
		})
	}
	// 个人信息的接口
	function postmerchant() {
		console.log('开始')
		//所缺少字段    出生日期    从业年限
		var id = localStorage.getItem('id'),
			avatar = localStorage.getItem('avatar'),
			operatorCode = localStorage.getItem('operatorCode'),
			password = localStorage.getItem('password'),
			operatorType = localStorage.getItem('operatorType'),
			avatar = localStorage.getItem('avatar'),                   		//个人头像
			personalSignature = $('.msgChild').eq(12).find('input').val()    // 个性签名
		operatorIdentityNo = localStorage.getItem('operatorIdentityNo'),
			sex = localStorage.getItem('sex')							//性别
		operatorMobile = localStorage.getItem('operatorMobile'),   		//手机
			nickName = $('.msgChild').eq(0).find('input').val(),
			operatorEmail = $('.msgChild').eq(6).find('input').val(),                   //邮箱
			streetName = $('.msgChild').eq(8).find('input').val(),
			companyName = $('.msgChild').eq(11).find('input').val(),
			customerBirthDate = localStorage.getItem('customerBirthDate'),
			businessYears = localStorage.getItem('businessYears'),      //从业年限
			province = localStorage.getItem('province'),
			city = localStorage.getItem('city'),
			area = localStorage.getItem('area')
		localStorage.setItem('personalSignature', personalSignature)
		$util.http('/api/merchant-operators', {
			data: {
				id: id,                                      //id
				operatorCode: operatorCode,					//顾问编号
				operatorType: operatorType,					//顾问身份类型
				operatorName: operatorName,	                	//真实姓名
				operatorIdentityNo: operatorIdentityNo,     	//身份证号码
				registerAgreement: 'Y',						 //平台注册协议
				status: true,                                 //是否激活
				password: password,                            //登陆密码
				operatorMobile: operatorMobile,                 //手机号码
				avatar,                                       //头像
				sex,
				nickName,
				streetName,
				operatorEmail,
				companyName,
				personalSignature,                         //个性签名
				customerBirthDate,                        //日期
				businessYears,
				companyName,
				province,
				city,
				area
			},
			dataType: 'json',
			type: 'put',
			success: function (res) {
				console.log(res)
				mui.toast('保存成功')
				mui.openWindow(
					'personal_homepage.html',
					'personal_homepage',
					{}
				)
			}
		})
	}

	// 保存
	$('#submit').on('tap', function () {
		console.log(1)
		postmerchant()
	})
	// 真实姓名
	$('.msgChild').eq(1).find('input').on('tap', function () {
		operatorName = localStorage.getItem('operatorName')
		if (operatorName == null) {
			mui.openWindow(
				'real_name_certification.html',
				'real_name_certification',
				{}
			)
		}

	})
	function name() {
		operatorName = localStorage.getItem('operatorName')
		if (operatorName == null) {
			$('.msgChild').eq(1).find('input').val('请实名认证')
		} else {
			$('.msgChild').eq(1).find('input').val(operatorName)
		}
	}

	// 身份证号
	function identityNo() {
		operatorIdentityNo = localStorage.getItem('operatorIdentityNo')
		if (operatorIdentityNo == null) {
			$('.msgChild').eq(2).find('input').val('请实名认证')
		} else {
			$('.msgChild').eq(2).find('input').val(operatorIdentityNo)
		}
	}
	$('.msgChild').eq(2).find('input').on('tap', function () {
		operatorIdentityNo = localStorage.getItem('operatorIdentityNo')
		if (operatorIdentityNo == 'null') {
			mui.openWindow(
				'real_name_certification.html',
				'real_name_certification',
				{}
			)
		}

	})

	// 选择性别
	$('.msgChild').eq(3).on('tap', function () {
		var picker = new mui.PopPicker();
		picker.setData([{
			value: '0',
			text: '女士'
		},
		{
			value: '1',
			text: '男士'
		}]);
		picker.show(function (selectItems) {
			console.log(selectItems)
			$('.msgChild').eq(3).find('input').val(selectItems[0].text)
			sex = selectItems[0].value
			localStorage.setItem('sex', sex)
		})
	})
	//选择日期
	$('.msgChild').eq(4).on('tap', function () {
		$util.showDatePicker(function (date) {
			console.log(date)
			$('.msgChild').eq(4).find('input').val(date.value)
			localStorage.setItem('customerBirthDate', date.value)
		})
	});
	//手机
	function Mobile() {
		operatorMobile = localStorage.getItem('operatorMobile')
		$('.msgChild').eq(5).find('input').val(operatorMobile)
	}

	// 所在城市
	$('.msgChild').eq(7).on('tap', function () {
		$util.showAdPicker(__CITY__, function (datas) {
			console.log(datas[0].text + '-' + datas[1].text + '-' + datas[2].text)
			$('.msgChild').eq(7).find('input').val(datas[0].text + '-' + datas[1].text + '-' + datas[2].text)
			localStorage.setItem('province', datas[0].value)
			localStorage.setItem('city', datas[1].value)
			localStorage.setItem('area', datas[2].value)
		});
	});
	// 街道地址
	// 我的职业
	function myType() {
		var operatorType = localStorage.getItem('operatorType')
		if (operatorType == 1) {
			$('.msgChild').eq(9).find('input').val('家居顾问')
		} else if (operatorType == 2) {
			$('.msgChild').eq(9).find('input').val('设计顾问')
		}
	}
	// 从业年限
	$('.msgChild').eq(10).on('tap', function () {
		var picker = new mui.PopPicker();
		picker.setData([{ value: '1', text: '1' }, { value: '2', text: '2' }, { value: '3', text: '3' }, { value: '4', text: '4' }
			, { value: '5', text: '5' }, { value: '6', text: '6' }, { value: '7', text: '7' }, { value: '8', text: '8' }, { value: '9', text: '9' },
		{ value: '10', text: '10' }, { value: '10~', text: '10年以上' }]);
		picker.show(function (selectItems) {
			console.log(selectItems[0].text);
			console.log(selectItems[0].value);
			$('.msgChild').eq(10).find('input').val(selectItems[0].text + '年')
			localStorage.setItem('businessYears', selectItems[0].value)
		})
	})
	//单位名称

</script>

</html>