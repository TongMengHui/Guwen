<!doctype html>
<html>

<head>
	<meta charset="UTF-8">
	<title>客户案例-客户信息</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<link href="../css/mui.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="../css/mui.picker.min.css">
	<link rel="stylesheet" type="text/css" href="../css/customer_case_customerInformation.css" />
	<link rel="stylesheet" href="../css/common.css">
	<link rel="stylesheet" type="text/css" href="../css/search_community.css" />
</head>

<body style="background-color: white;">
	<header class="mui-bar mui-bar-nav mui-bar-nav-bg" style="background-color: white; box-shadow: none; border-bottom: 1px solid #EEEEEE;">
		<span class="mui-icon mui-icon-back"></span>
		<span class="mui-title" style="font-size: 18px; color: #333333;">发布案例</span>
	</header>
	<div class="mui-content" style="background-color: white;">
		<div id="time-line-container">
			<div id="line">
				<div id="line-front"></div>
				<div id="line-middle"></div>
				<div id="line-back"></div>
			</div>
			<div id="round-attribute">
				<img src="../img/attribute.png" style="width: 100%; height: 100%;" />
			</div>
			<div id="round-description">
				<img src="../img/description.png" style="width: 100%; height: 100%;" />
			</div>
			<div id="round-relate-products">
				<img src="../img/relate-products.png" style="width: 100%; height: 100%;" />
			</div>
			<div id="round-customer-information">
				<img src="../img/customer-information.png" style="width: 100%; height: 100%;" />
			</div>
			<div id="font-attribute">案例属性</div>
			<div id="font-description">案例描述</div>
			<div id="font-relate-products">关联产品</div>
			<div id="font-customer-information">客户信息</div>
		</div>
		<div class="products-caption">
			客户信息
		</div>
		<div class="client-info-container">
			<div class="info-caption">
				用户姓名：
			</div>
			<input class="info-input" id="customerName" placeholder="请填写用户真实姓名" />
		</div>
		<div class="client-info-container">
			<div class="info-caption">
				性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;别：
			</div>
			<input class="info-input" id="customerSex" placeholder="先生" />
			<a href="#">
				<div class="info-more-container">
					<div class="info-more-icon">
						<span class="mui-icon mui-icon-arrowright"></span>
					</div>
					<div class="info-more-font">选择</div>
				</div>
			</a>
		</div>
		<div class="client-info-container">
			<div class="info-caption">
				手机号码：
			</div>
			<input class="info-input" id="customerMobile" placeholder="请填写客户手机号码" />
			<div class="info-more-container">
				<div class="info-more-font">非必填</div>
			</div>
		</div>
		<div class="client-info-container">
			<div class="info-caption">
				所在地：
			</div>
			<input class="info-input" id="area" placeholder="选择客户住宅所在地" />
			<a href="#">
				<div class="info-more-container">
					<div class="info-more-icon">
						<span class="mui-icon mui-icon-arrowright"></span>
					</div>
					<div class="info-more-font">选择</div>
				</div>
			</a>
		</div>
		<div class="client-info-container">
			<div class="info-caption">
				所属小区：
			</div>
			<input class="info-input" id="customerVillage" placeholder="请选择所属小区" />
			<!-- <a href="search_community.html"> -->
			<div class="info-more-container" id="gosearch">
				<div class="info-more-icon">
					<span class="mui-icon mui-icon-arrowright"></span>
				</div>
				<div class="info-more-font">选择</div>
			</div>
			<!-- </a> -->
		</div>
		<a href="customer_case.html">
			<button class="publish-btn">发布</button>
		</a>

</body>


<div id="search" style="background-color: white; position:fixed;top:0;width:100%; height:100%;display:none;">
	<header class="mui-bar mui-bar-nav mui-bar-nav-bg" style="background-color: white; box-shadow: none;">
		<span class="mui-icon mui-icon-back" id="back"></span>
		<h1 class="mui-title" style="color: #333333;">搜索小区</h1>
	</header>
	<div class="mui-content" style="background-color: white;">
		<div class="search-content">
			<div class="search-input">
				<input class="search-input1" type="text" placeholder="请搜索小区">
			</div>
			<div class="search-icon">
				<span class="mui-icon mui-icon-search"></span>
			</div>
		</div>
		<ul class="where-list">

		</ul>
	</div>
</div>
<script src="../js/mui.min.js"></script>
<script type="text/javascript" src="../js/jquery-1.11.0.min.js"></script>
<script src="../js/mui.picker.js"></script>
<script src="../js/mui.poppicker.js"></script>
<script type="text/javascript" src="../js/icon-back.js"></script>
<script src="../js/util.js"></script>
<script type="text/javascript">
	mui.init(
	)
	var infoMore = mui('.info-more-font')
	var infoInput = mui('.info-input')


	// 选择性别
	infoMore[0].addEventListener('tap', function () {
		var picker = new mui.PopPicker();
		picker.setData([{
			value: '0',
			text: '先生'
		},
		{
			value: '1',
			text: '女士'
		}]);
		picker.show(function (selectItems) {
			console.log(selectItems)
			infoInput[1].value = selectItems[0].text
		})
	})
	// 选择所在地
	infoMore[2].addEventListener('tap', function () {
		// 省市区
		$util.http('/api/districts', {
			dataType: 'json',
			type: 'get',
			success: function (res) {
				console.log(res)
				var jsonStr1 = JSON.stringify(res)
				var jsonArr = [];
				for (var i = 0; i < res.length; i++) {
					jsonArr[i] = res[i];
				}
				console.log(jsonArr)


				var picker = new mui.PopPicker({
					layer: 2
				});
				picker.setData([{
					value: '110000',
					text: '北京市',
					children: [{
						value: "110101",
						text: "东城区"
					}]
				}, {
					value: '120000',
					text: '天津市',
					children: [{
						value: "120101",
						text: "和平区"
					}, {
						value: "120102",
						text: "河东区"
					}, {
						value: "120104",
						text: "南开区"
					}
					]
				}])
				picker.pickers[0].setSelectedIndex(1);
				picker.pickers[1].setSelectedIndex(1);
				picker.show(function (SelectedItem) {
					console.log(SelectedItem);
				})
			}
		})
	})

	//gosearch
	$('#gosearch').on('tap', function () {
		$('#search').show()
	})


	// 搜索小区
	var whereList = mui('.where-list')[0]
	var searchIcon = mui('.search-icon')[0]
	// 通过接口获取小区数据 插入小区
	for (var i = 0; i < 10; i++) {
		whereList.innerHTML +=
			`<li class="where-city" wherename="康桥丽都">
							<div class="where-city-prompt1">康桥丽都</div>
							<div class="where-city-prompt2">
								<button class="btn-yes">确定</button>
							</div>
						</li>`
	}
	//  点击放入input框内
	$('.where-city').on('click', function () {
		console.log($(this).attr('wherename'))
		$('.search-input1').val($(this).attr('wherename'))
		$('.where-city').hide()
		$('#customerVillage').val($('.search-input1').val())
		$('#search').hide()
	})
	// 点击back
	$('.mui-icon-search').on('tap', function () {
		$('#search').hide()
	})
	//  input框值与数据库的值对比 
	function searchVillage() {
		var searchVal = mui('.search-input input')[0].value
		var whereCity = mui('.where-city')
		console.log(searchVal)
		if (searchVal == '') {
			$('.where-city').hide()
		} else {
			whereCity.each(function () {
				var wherename = $(this).attr('wherename')
				if (wherename.indexOf(searchVal) != -1) {
					$(this).show()
				} else {
					$(this).hide()
				}
			})
		}
	}
	//  input框值与数据对比 
	$('.search-input input').bind('input propertychange', function () {
		searchVillage();
	});


	// 获取家居案例的接口
	$(".publish-btn").on('tap', function () {
		var operatorId = localStorage.getItem('id'),
			customerName = $('#customerName').val(),
			customerSex = $('#customerSex').val(),
			customerMobile = $('#customerMobile').val(),
			area = $('#area').val(),
			customerVillage = $('#customerVillage').val(),
			casesName = localStorage.getItem('casesName'),
			casesImage = localStorage.getItem('casesImage'),
			casesDesc = localStorage.getItem('casesDesc'),
			customerProvince = customer_Province,
			customerCity = customerCity,
			customerArea = customerArea
		$util.http('/api/home-cases', {
			data: {
				operatorId,
				customerName,
				customerSex,
				customerMobile,
				customerVillage,
				casesName,
				casesImage,
				casesDesc,
				customerProvince,
				customerCity,
				customerArea
			},
			dataType: 'json',
			type: 'post',
			success: function (res) {

			}
		})
	})


</script>

</html>